<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Carrito de Compras</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="carrito.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>

<body>

    <!-- Esta parte del codigo es la barra de navegacion de la tienda -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
                <i class="bi bi-car-front-fill me-2 fs-3"></i>AutoStore
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html"><i class="bi bi-house-door me-1"></i>Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="catalogo.html"><i class="bi bi-grid me-1"></i>Catálogo</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="ofertas.html"><i class="bi bi-tag me-1"></i>Ofertas</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Carrito de Compras -->
    <div class="container my-5">
        <h2 class="mb-4">Carrito de Compras</h2>
        <div class="table-responsive">
            <table class="table table-bordered align-middle" id="cart-table">
                <thead class="table-light">
                    <tr>
                        <th>Producto</th>
                        <th>Precio</th>
                        <th>Cantidad</th>
                        <th>Subtotal</th>
                        <th>Eliminar</th>
                    </tr>
                </thead>
                <tbody id="cart-body">
                    <!-- Productos agregados dinámicamente -->
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-end align-items-center">
            <h4 class="me-3">Total: $<span id="cart-total">0</span></h4>
            <div class="dropdown">
                <button class="btn btn-success btn-lg dropdown-toggle" type="button" id="payDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Pagar
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="payDropdown">
                    <li><a class="dropdown-item pay-link" href="https://www.bancofalabella.cl/" target="_blank">Banco
                            Falabella</a></li>
                    <li><a class="dropdown-item pay-link" href="https://www.forum.cl/" target="_blank">Forum</a></li>
                    <li><a class="dropdown-item pay-link" href="https://webpay.cl" target="_blank">Webpay</a></li>
                </ul>
            </div>
        </div>

        <!-- Notificación: Carrito vacío -->
        <div id="cart-alert" class="alert alert-warning alert-dismissible fade" role="alert"
            style="position: fixed; top: 80px; right: 20px; z-index: 1055;">
            <strong>¡Atención!</strong> No hay ningún producto agregado al carrito.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
        <!-- Notificación: Cantidad no agregada -->
        <div id="cart-qty-alert" class="alert alert-warning alert-dismissible fade" role="alert"
            style="position: fixed; top: 130px; right: 20px; z-index: 1055;">
            <strong>¡Atención!</strong> No ha agregado cantidad de producto.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>


    </div>
    <div class="container my-4">
        <h3>Resumen del Carrito</h3>
        <div class="card">
            <div class="card-body">
                <p class="mb-1">Total de productos: <span id="cart-count">0</span></p>
                <p class="mb-1">Subtotal: $<span id="cart-subtotal">0</span></p>
            </div>
        </div>
    </div>
    <div class="container my-4">
        <div class="accordion shadow-lg rounded-4 overflow-hidden" id="infoAccordion">
            <div class="accordion-item border-0">
                <h2 class="accordion-header" id="headingPago">
                    <button class="accordion-button bg-success bg-opacity-10 fw-semibold" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapsePago" aria-expanded="true" aria-controls="collapsePago">
                        <i class="bi bi-credit-card me-2 text-success"></i> Instrucciones de Pago
                    </button>
                </h2>
                <div id="collapsePago" class="accordion-collapse collapse" aria-labelledby="headingPago"
                    data-bs-parent="#infoAccordion">
                    <div class="accordion-body">
                        <p>Para completar tu compra, por favor sigue estos pasos:</p>
                        <ol>
                            <li>Haz clic en el botón <span class="badge bg-success">Pagar</span> para ser redirigido a la plataforma de pago.</li>
                            <li>Ingresa tus datos de pago y confirma la transacción.</li>
                            <li>Una vez completado el pago, recibirás un correo de confirmación.</li>
                        </ol>
                        <div class="alert alert-info mt-3 mb-0 p-2">
                            Si tienes alguna duda, contáctanos a través de nuestro correo electrónico o número de teléfono.
                        </div>
                        <p class="mt-2 text-success fw-bold">¡Gracias por tu compra!</p>
                    </div>
                </div>
            </div>
            <div class="accordion-item border-0">
                <h2 class="accordion-header" id="headingDevoluciones">
                    <button class="accordion-button collapsed bg-warning bg-opacity-10 fw-semibold" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseDevoluciones" aria-expanded="false"
                        aria-controls="collapseDevoluciones">
                        <i class="bi bi-arrow-counterclockwise me-2 text-warning"></i> Política de Devoluciones
                    </button>
                </h2>
                <div id="collapseDevoluciones" class="accordion-collapse collapse" aria-labelledby="headingDevoluciones"
                    data-bs-parent="#infoAccordion">
                    <div class="accordion-body">
                        <p>Si no estás satisfecho con tu compra, puedes devolver el producto dentro de los <strong>30 días</strong> siguientes a la compra. Asegúrate de que el producto esté en su estado original y con el embalaje intacto.</p>
                        <div class="alert alert-warning p-2 mb-2">
                            Los productos en oferta o rebajados no son elegibles para devolución, a menos que estén defectuosos.
                        </div>
                        <p>Para iniciar una devolución, contáctanos a través de nuestro correo electrónico o número de teléfono.</p>
                    </div>
                </div>
            </div>
            <div class="accordion-item border-0">
                <h2 class="accordion-header" id="headingContacto">
                    <button class="accordion-button collapsed bg-primary bg-opacity-10 fw-semibold" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseContacto" aria-expanded="false" aria-controls="collapseContacto">
                        <i class="bi bi-envelope-at me-2 text-primary"></i> Contacto
                    </button>
                </h2>
                <div id="collapseContacto" class="accordion-collapse collapse" aria-labelledby="headingContacto"
                    data-bs-parent="#infoAccordion">
                    <div class="accordion-body">
                        <p>Si tienes alguna pregunta o necesitas ayuda, no dudes en contactarnos:</p>
                        <ul class="list-unstyled mb-2">
                            <li class="mb-1"><i class="bi bi-envelope me-1 text-primary"></i>
                                <strong>Email:</strong>
                                <a href="mailto:info@autostore.com" class="text-decoration-underline">info@autostore.com</a>
                            </li>
                            <li><i class="bi bi-telephone me-1 text-primary"></i>
                                <strong>Teléfono:</strong> +56 9 1234 5678
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="accordion-item border-0">
                <h2 class="accordion-header" id="headingRedes">
                    <button class="accordion-button collapsed bg-info bg-opacity-10 fw-semibold" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseRedes" aria-expanded="false" aria-controls="collapseRedes">
                        <i class="bi bi-share me-2 text-info"></i> Redes Sociales
                    </button>
                </h2>
                <div id="collapseRedes" class="accordion-collapse collapse" aria-labelledby="headingRedes"
                    data-bs-parent="#infoAccordion">
                    <div class="accordion-body">
                        <p>Síguenos en nuestras redes sociales para estar al tanto de las últimas novedades y ofertas:</p>
                        <ul class="list-inline fs-5 mb-0">
                            <li class="list-inline-item">
                                <a href="https://www.facebook.com/autostore" target="_blank" class="text-decoration-none text-primary">
                                    <i class="bi bi-facebook"></i> Facebook
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.instagram.com/autostore" target="_blank" class="text-decoration-none text-danger">
                                    <i class="bi bi-instagram"></i> Instagram
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.twitter.com/autostore" target="_blank" class="text-decoration-none text-info">
                                    <i class="bi bi-twitter"></i> Twitter
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="accordion-item border-0">
                <h2 class="accordion-header" id="headingFAQ">
                    <button class="accordion-button collapsed bg-light fw-semibold" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseFAQ" aria-expanded="false" aria-controls="collapseFAQ">
                        <i class="bi bi-question-circle me-2 text-secondary"></i> Preguntas Frecuentes
                    </button>
                </h2>
                <div id="collapseFAQ" class="accordion-collapse collapse" aria-labelledby="headingFAQ"
                    data-bs-parent="#infoAccordion">
                    <div class="accordion-body">
                        <div class="mb-2">
                            <p class="mb-1 fw-bold"><i class="bi bi-cart-plus me-1 text-success"></i> ¿Cómo puedo agregar productos al carrito?</p>
                            <p class="mb-2">Navega por nuestro catálogo y haz clic en el botón <span class="badge bg-success">Agregar al carrito</span> en el producto deseado.</p>
                        </div>
                        <div class="mb-2">
                            <p class="mb-1 fw-bold"><i class="bi bi-bag-check me-1 text-primary"></i> ¿Cómo puedo ver mi carrito de compras?</p>
                            <p class="mb-2">Haz clic en el icono del carrito en la parte superior derecha de la página para ver los productos que has agregado.</p>
                        </div>
                        <div class="mb-2">
                            <p class="mb-1 fw-bold"><i class="bi bi-pencil-square me-1 text-warning"></i> ¿Puedo modificar la cantidad de un producto en el carrito?</p>
                            <p class="mb-2">Sí, puedes cambiar la cantidad directamente desde el carrito. Simplemente ajusta el número y se actualizará automáticamente.</p>
                        </div>
                        <div>
                            <p class="mb-1 fw-bold"><i class="bi bi-credit-card-2-front me-1 text-info"></i> ¿Qué métodos de pago aceptan?</p>
                            <p>Aceptamos tarjetas de crédito, débito y transferencias bancarias. Todos los pagos son seguros y se procesan a través de plataformas confiables.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <footer class="bg-dark text-white pt-4 pb-3 mt-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-4 text-center text-md-start mb-3 mb-md-0">
                    <small>&copy; 2024 AutoStore. Todos los derechos reservados.</small>
                </div>
                <div class="col-md-4 text-center mb-3 mb-md-0">
                    <a href="https://facebook.com" target="_blank" class="text-white me-3" aria-label="Facebook">
                        <i class="bi bi-facebook fs-4"></i>
                    </a>
                    <a href="https://instagram.com" target="_blank" class="text-white me-3" aria-label="Instagram">
                        <i class="bi bi-instagram fs-4"></i>
                    </a>
                    <a href="https://twitter.com" target="_blank" class="text-white me-3" aria-label="Twitter">
                        <i class="bi bi-twitter fs-4"></i>
                    </a>
                    <a href="https://wa.me/" target="_blank" class="text-white" aria-label="WhatsApp">
                        <i class="bi bi-whatsapp fs-4"></i>
                    </a>
                </div>
                <div class="col-md-4 text-center text-md-end">
                    <nav>
                        <ul class="list-inline mb-0">
                            <li class="list-inline-item"><a href="index.html"
                                    class="text-white text-decoration-underline">Inicio</a></li>
                            <li class="list-inline-item"><a href="catalogo.html"
                                    class="text-white text-decoration-underline">Catálogo</a></li>
                            <li class="list-inline-item"><a href="ofertas.html"
                                    class="text-white text-decoration-underline">Ofertas</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </footer>

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


<!-- Carrito JS -->
<script>
    // Obtener carrito desde localStorage
    function getCart() {
        return JSON.parse(localStorage.getItem('cart')) || [];
    }

    function saveCart(cart) {
        localStorage.setItem('cart', JSON.stringify(cart));
    }

    function renderCart() {
        const cart = getCart();
        const cartBody = document.getElementById('cart-body');
        const cartTotal = document.getElementById('cart-total');
        cartBody.innerHTML = '';
        let total = 0;
        cart.forEach((item, idx) => {
            const subtotal = item.price * item.quantity;
            total += subtotal;
            const row = document.createElement('tr');
            row.innerHTML = `
                    <td>${item.name}</td>
                    <td>$${item.price.toLocaleString()}</td>
                    <td>
                        <input type="number" min="1" value="${item.quantity}" class="form-control form-control-sm quantity-input" data-idx="${idx}">
                    </td>
                    <td>$${subtotal.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-danger btn-sm remove-btn" data-idx="${idx}">&times;</button>
                    </td>
                `;
            cartBody.appendChild(row);
        });
        cartTotal.textContent = total.toLocaleString();
    }

    // Actualizar cantidad
    document.addEventListener('input', function (e) {
        if (e.target.classList.contains('quantity-input')) {
            const idx = e.target.getAttribute('data-idx');
            let cart = getCart();
            cart[idx].quantity = Math.max(1, parseInt(e.target.value));
            saveCart(cart);
            renderCart();
        }
    });

    // Eliminar producto
    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('remove-btn')) {
            const idx = e.target.getAttribute('data-idx');
            let cart = getCart();
            cart.splice(idx, 1);
            saveCart(cart);
            renderCart();
        }
    });

    // Inicializar carrito
    document.addEventListener('DOMContentLoaded', renderCart);
</script>


<script>
    function renderCartSummary() {
        const cart = getCart();
        let count = 0;
        let subtotal = 0;
        cart.forEach(item => {
            count += item.quantity;
            subtotal += item.price * item.quantity;
        });
        document.getElementById('cart-count').textContent = count;
        document.getElementById('cart-subtotal').textContent = subtotal.toLocaleString();
    }
    // Llama también al render del resumen cuando se actualiza el carrito
    function renderCart() {
        const cart = getCart();
        const cartBody = document.getElementById('cart-body');
        const cartTotal = document.getElementById('cart-total');
        cartBody.innerHTML = '';
        let total = 0;
        cart.forEach((item, idx) => {
            const subtotal = item.price * item.quantity;
            total += subtotal;
            const row = document.createElement('tr');
            row.innerHTML = `
                        <td>${item.name}</td>
                        <td>$${item.price.toLocaleString()}</td>
                        <td>
                            <input type="number" min="1" value="${item.quantity}" class="form-control form-control-sm quantity-input" data-idx="${idx}">
                        </td>
                        <td>$${subtotal.toLocaleString()}</td>
                        <td>
                            <button class="btn btn-danger btn-sm remove-btn" data-idx="${idx}">&times;</button>
                        </td>
                    `;
            cartBody.appendChild(row);
        });
        cartTotal.textContent = total.toLocaleString();
        renderCartSummary();
    }
    // Inicializar resumen al cargar
    document.addEventListener('DOMContentLoaded', renderCartSummary);
</script>

<script>
    // Oculta la alerta al inicio
    document.getElementById('cart-alert').classList.remove('show');
    document.querySelectorAll('.pay-link').forEach(link => {
        link.addEventListener('click', function (e) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (!cart.length) {
                e.preventDefault();
                const alertDiv = document.getElementById('cart-alert');
                alertDiv.classList.add('show');
                // Oculta automáticamente después de 4 segundos
                setTimeout(() => {
                    alertDiv.classList.remove('show');
                }, 4000);
            }
        });
    });
</script>

<script>
    // Función para mostrar alertas
    function showAlert(id) {
        const alertDiv = document.getElementById(id);
        alertDiv.classList.add('show');
        setTimeout(() => {
            alertDiv.classList.remove('show');
        }, 4000);
    }

    // Validación al intentar pagar
    document.querySelectorAll('.pay-link').forEach(link => {
        link.addEventListener('click', function (e) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (!cart.length) {
                e.preventDefault();
                showAlert('cart-alert');
                return;
            }
            // Verifica si algún producto tiene cantidad inválida (vacía, 0 o menor a 1)
            let invalidQty = cart.some(item => !item.quantity || isNaN(item.quantity) || item.quantity < 1);
            if (invalidQty) {
                e.preventDefault();
                showAlert('cart-qty-alert');
                return;
            }
        });
    });
</script>

</html>