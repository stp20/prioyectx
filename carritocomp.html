<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Carrito de Compras</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="carrito.css">
</head>

<body>
    <!-- NAVBAR (igual que index.html) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">Mi Tienda</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="catalogo.html">Catálogo</a></li>
                    <li class="nav-item"><a class="nav-link" href="ofertas.html">Ofertas</a></li>
                    <li class="nav-item"><a class="nav-link active" href="carrito.html">Carrito</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Carrito de Compras -->
    <div class="container my-5">
        <h2 class="mb-4">Carrito de Compras</h2>
        <div class="table-responsive">
            <table class="table table-bordered align-middle" id="cart-table">
                <thead class="table-light">
                    <tr>
                        <th>Producto</th>
                        <th>Precio</th>
                        <th>Cantidad</th>
                        <th>Subtotal</th>
                        <th>Eliminar</th>
                    </tr>
                </thead>
                <tbody id="cart-body">
                    <!-- Productos agregados dinámicamente -->
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-end align-items-center">
            <h4 class="me-3">Total: $<span id="cart-total">0</span></h4>
            <a href="https://webpay.cl" class="btn btn-success btn-lg" id="pay-btn" target="_blank">Pagar</a>
        </div>
    </div>

    <!-- FOOTER (igual que index.html) -->
    <footer class="bg-dark text-white text-center py-3 mt-auto w-100 position-fixed bottom-0 start-0">
        <div class="container">
            <p class="mb-0">&copy; 2024 Mi Tienda. Todos los derechos reservados.</p>
        </div>
    </footer>

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


<!-- Carrito JS -->
<script>
    // Obtener carrito desde localStorage
    function getCart() {
        return JSON.parse(localStorage.getItem('cart')) || [];
    }

    function saveCart(cart) {
        localStorage.setItem('cart', JSON.stringify(cart));
    }

    function renderCart() {
        const cart = getCart();
        const cartBody = document.getElementById('cart-body');
        const cartTotal = document.getElementById('cart-total');
        cartBody.innerHTML = '';
        let total = 0;
        cart.forEach((item, idx) => {
            const subtotal = item.price * item.quantity;
            total += subtotal;
            const row = document.createElement('tr');
            row.innerHTML = `
                    <td>${item.name}</td>
                    <td>$${item.price.toLocaleString()}</td>
                    <td>
                        <input type="number" min="1" value="${item.quantity}" class="form-control form-control-sm quantity-input" data-idx="${idx}">
                    </td>
                    <td>$${subtotal.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-danger btn-sm remove-btn" data-idx="${idx}">&times;</button>
                    </td>
                `;
            cartBody.appendChild(row);
        });
        cartTotal.textContent = total.toLocaleString();
    }

    // Actualizar cantidad
    document.addEventListener('input', function (e) {
        if (e.target.classList.contains('quantity-input')) {
            const idx = e.target.getAttribute('data-idx');
            let cart = getCart();
            cart[idx].quantity = Math.max(1, parseInt(e.target.value));
            saveCart(cart);
            renderCart();
        }
    });

    // Eliminar producto
    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('remove-btn')) {
            const idx = e.target.getAttribute('data-idx');
            let cart = getCart();
            cart.splice(idx, 1);
            saveCart(cart);
            renderCart();
        }
    });

    // Inicializar carrito
    document.addEventListener('DOMContentLoaded', renderCart);
</script>


<script>
    function renderCartSummary() {
        const cart = getCart();
        let count = 0;
        let subtotal = 0;
        cart.forEach(item => {
            count += item.quantity;
            subtotal += item.price * item.quantity;
        });
        document.getElementById('cart-count').textContent = count;
        document.getElementById('cart-subtotal').textContent = subtotal.toLocaleString();
    }
    // Llama también al render del resumen cuando se actualiza el carrito
    function renderCart() {
        const cart = getCart();
        const cartBody = document.getElementById('cart-body');
        const cartTotal = document.getElementById('cart-total');
        cartBody.innerHTML = '';
        let total = 0;
        cart.forEach((item, idx) => {
            const subtotal = item.price * item.quantity;
            total += subtotal;
            const row = document.createElement('tr');
            row.innerHTML = `
                        <td>${item.name}</td>
                        <td>$${item.price.toLocaleString()}</td>
                        <td>
                            <input type="number" min="1" value="${item.quantity}" class="form-control form-control-sm quantity-input" data-idx="${idx}">
                        </td>
                        <td>$${subtotal.toLocaleString()}</td>
                        <td>
                            <button class="btn btn-danger btn-sm remove-btn" data-idx="${idx}">&times;</button>
                        </td>
                    `;
            cartBody.appendChild(row);
        });
        cartTotal.textContent = total.toLocaleString();
        renderCartSummary();
    }
    // Inicializar resumen al cargar
    document.addEventListener('DOMContentLoaded', renderCartSummary);
</script>

</html>